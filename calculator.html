<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Calculator - India Finance Calculator Suite</title>
  <link rel="stylesheet" href="style.css"/>
  <style>
    .calc-container {
      max-width: 400px;
      margin: 20px auto;
      background: var(--card);
      border: 1px solid #1e2a44;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .calc-display {
      width: 100%;
      height: 80px;
      background: #0b1324;
      border: 1px solid #22304d;
      border-radius: 12px;
      color: #e8f0ff;
      font-size: 24px;
      text-align: right;
      padding: 0 15px;
      margin-bottom: 20px;
      font-family: 'Courier New', monospace;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    
    .calc-history {
      font-size: 14px;
      color: var(--muted);
      margin-bottom: 5px;
      min-height: 20px;
    }
    
    .calc-current {
      font-size: 28px;
      font-weight: bold;
    }
    
    .calc-buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }
    
    .calc-btn {
      height: 60px;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .calc-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    .calc-btn.number {
      background: #1a2332;
      color: #e8f0ff;
      border: 1px solid #2a3a52;
    }
    
    .calc-btn.operator {
      background: var(--acc);
      color: #00102a;
    }
    
    .calc-btn.clear {
      background: var(--bad);
      color: white;
    }
    
    .calc-btn.equals {
      background: var(--good);
      color: white;
      grid-column: span 2;
    }
    
    .calc-btn.zero {
      grid-column: span 2;
    }
    
    /* Light theme */
    .light .calc-display {
      background: #f8f9fa;
      border-color: #dee2e6;
      color: #0d1b2a;
    }
    
    .light .calc-btn.number {
      background: #ffffff;
      color: #0d1b2a;
      border-color: #ced4da;
    }
    
    .back-link {
      display: inline-block;
      margin: 20px;
      padding: 10px 20px;
      background: var(--acc);
      color: #00102a;
      text-decoration: none;
      border-radius: 12px;
      font-weight: 600;
      transition: all 0.2s ease;
    }
    
    .back-link:hover {
      filter: brightness(1.1);
      transform: translateY(-1px);
    }
    
    .calc-header {
      text-align: center;
      margin-bottom: 20px;
    }
    
    .calc-header h1 {
      color: var(--text);
      margin: 0;
      font-size: 24px;
    }
    
    .calc-header p {
      color: var(--muted);
      margin: 5px 0 0;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class='theme-toggle' onclick='toggleTheme()'>üåì Theme</div>
  
  <a href="index.html" class="back-link">‚Üê Back to Finance Calculators</a>
  
  <div class="calc-container">
    <div class="calc-header">
      <h1>üßÆ Calculator</h1>
      <p>Basic math calculations</p>
    </div>
    
    <div class="calc-display">
      <div class="calc-history" id="calc-history"></div>
      <div class="calc-current" id="calc-current">0</div>
    </div>
    
    <div class="calc-buttons">
      <button class="calc-btn clear" onclick="clearAll()">AC</button>
      <button class="calc-btn clear" onclick="clearEntry()">CE</button>
      <button class="calc-btn operator" onclick="inputOperator('%')" title="Percentage">%</button>
      <button class="calc-btn operator" onclick="inputOperator('/')" title="Divide">√∑</button>
      
      <button class="calc-btn number" onclick="inputNumber('7')">7</button>
      <button class="calc-btn number" onclick="inputNumber('8')">8</button>
      <button class="calc-btn number" onclick="inputNumber('9')">9</button>
      <button class="calc-btn operator" onclick="inputOperator('*')" title="Multiply">√ó</button>
      
      <button class="calc-btn number" onclick="inputNumber('4')">4</button>
      <button class="calc-btn number" onclick="inputNumber('5')">5</button>
      <button class="calc-btn number" onclick="inputNumber('6')">6</button>
      <button class="calc-btn operator" onclick="inputOperator('-')" title="Subtract">‚àí</button>
      
      <button class="calc-btn number" onclick="inputNumber('1')">1</button>
      <button class="calc-btn number" onclick="inputNumber('2')">2</button>
      <button class="calc-btn number" onclick="inputNumber('3')">3</button>
      <button class="calc-btn operator" onclick="inputOperator('+')" title="Add">+</button>
      
      <button class="calc-btn operator" onclick="toggleSign()" title="Plus/Minus">¬±</button>
      <button class="calc-btn number" onclick="inputNumber('0')">0</button>
      <button class="calc-btn number" onclick="inputDecimal()">.</button>
      <button class="calc-btn equals" onclick="calculate()" title="Equals">=</button>
    </div>
  </div>

  <script>
    let currentInput = '0';
    let previousInput = '';
    let operator = '';
    let waitingForOperand = false;
    let history = '';

    function updateDisplay() {
      document.getElementById('calc-current').textContent = currentInput;
      document.getElementById('calc-history').textContent = history;
    }

    function inputNumber(num) {
      if (waitingForOperand) {
        currentInput = num;
        waitingForOperand = false;
      } else {
        currentInput = currentInput === '0' ? num : currentInput + num;
      }
      updateDisplay();
    }

    function inputDecimal() {
      if (waitingForOperand) {
        currentInput = '0.';
        waitingForOperand = false;
      } else if (currentInput.indexOf('.') === -1) {
        currentInput += '.';
      }
      updateDisplay();
    }

    function inputOperator(nextOperator) {
      const inputValue = parseFloat(currentInput);

      // Special handling for percentage - it should work immediately on current input
      if (nextOperator === '%') {
        if (previousInput !== '' && operator) {
          // If we have a pending operation like 5000 *, then 10% should give us 5000 * (10/100)
          const percentValue = inputValue / 100;
          const newValue = performCalculation(previousInput, percentValue, operator);
          currentInput = String(newValue);
          history = `${previousInput} ${operator === '*' ? '√ó' : operator === '/' ? '√∑' : operator === '+' ? '+' : '‚àí'} ${inputValue}% =`;
          previousInput = '';
          operator = '';
          waitingForOperand = true;
        } else {
          // Just convert current number to percentage
          currentInput = String(inputValue / 100);
          history = `${inputValue}% =`;
          waitingForOperand = true;
        }
        updateDisplay();
        return;
      }

      if (previousInput === '') {
        previousInput = inputValue;
      } else if (operator) {
        const currentValue = previousInput || 0;
        const newValue = performCalculation(currentValue, inputValue, operator);

        currentInput = String(newValue);
        previousInput = newValue;
        updateDisplay();
      }

      waitingForOperand = true;
      operator = nextOperator;
      
      // Update history
      const operatorSymbol = {
        '+': '+',
        '-': '‚àí',
        '*': '√ó',
        '/': '√∑'
      };
      history = `${previousInput} ${operatorSymbol[operator]}`;
      updateDisplay();
    }

    function calculate() {
      const inputValue = parseFloat(currentInput);

      if (previousInput !== '' && operator && !waitingForOperand) {
        const newValue = performCalculation(previousInput, inputValue, operator);
        
        // Update history to show complete calculation
        const operatorSymbol = {
          '+': '+',
          '-': '‚àí',
          '*': '√ó',
          '/': '√∑',
          '%': '%'
        };
        history = `${previousInput} ${operatorSymbol[operator]} ${inputValue} =`;
        
        currentInput = String(newValue);
        previousInput = '';
        operator = '';
        waitingForOperand = true;
        updateDisplay();
      }
    }

    function performCalculation(firstOperand, secondOperand, operator) {
      switch (operator) {
        case '+':
          return firstOperand + secondOperand;
        case '-':
          return firstOperand - secondOperand;
        case '*':
          return firstOperand * secondOperand;
        case '/':
          if (secondOperand === 0) {
            alert('Cannot divide by zero!');
            return firstOperand;
          }
          return firstOperand / secondOperand;
        case '%':
          // For percentage: if we have 5000 * 10%, it should be 5000 * (10/100) = 500
          // But if we just want 10% as 0.1, then 10% should convert to 0.1
          return firstOperand * (secondOperand / 100);
        default:
          return secondOperand;
      }
    }

    function toggleSign() {
      if (currentInput !== '0') {
        if (currentInput.charAt(0) === '-') {
          currentInput = currentInput.slice(1);
        } else {
          currentInput = '-' + currentInput;
        }
        updateDisplay();
      }
    }

    function clearAll() {
      currentInput = '0';
      previousInput = '';
      operator = '';
      waitingForOperand = false;
      history = '';
      updateDisplay();
    }

    function clearEntry() {
      currentInput = '0';
      updateDisplay();
    }

    // Keyboard support
    document.addEventListener('keydown', function(event) {
      const key = event.key;
      
      if (key >= '0' && key <= '9') {
        inputNumber(key);
      } else if (key === '.') {
        inputDecimal();
      } else if (key === '+') {
        inputOperator('+');
      } else if (key === '-') {
        inputOperator('-');
      } else if (key === '*') {
        inputOperator('*');
      } else if (key === '/') {
        event.preventDefault();
        inputOperator('/');
      } else if (key === '%') {
        inputOperator('%');
      } else if (key === 'Enter' || key === '=') {
        event.preventDefault();
        calculate();
      } else if (key === 'Escape') {
        clearAll();
      } else if (key === 'Delete') {
        clearEntry();
      } else if (key === 'Backspace') {
        if (currentInput.length > 1) {
          currentInput = currentInput.slice(0, -1);
        } else {
          currentInput = '0';
        }
        updateDisplay();
      }
    });

    // Theme toggle function (same as main page)
    function toggleTheme() { 
      const isLight = document.body.classList.toggle('light'); 
      try {
        localStorage.setItem('theme', isLight ? 'light' : 'dark');
      } catch(e) {}
    }

    // Apply saved theme
    window.addEventListener('DOMContentLoaded', () => {
      try {
        const saved = localStorage.getItem('theme');
        if (saved === 'light') { 
          document.body.classList.add('light'); 
        } else { 
          document.body.classList.remove('light'); 
        }
      } catch(e) { /* ignore */ }
    }, { once: true });

    // Initialize display
    updateDisplay();
  </script>
</body>
</html>
